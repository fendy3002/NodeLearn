<!DOCTYPE html>
<html>

<head>
</head>

<body>
    <div id="stage-parent" style="overflow-x:scroll">
        <div id="container"></div>
    </div>
    <script src="https://unpkg.com/konva@4.0.0/konva.min.js"></script>
    <script>
        let style = {};
        style.point = {
            base: {
                radius: 12,
                fill: '#FFFFFF',
                stroke: '#AAAAAA',
                strokeWidth: 6
            }
        };

        style.point.pending = {
            ...style.point.base,
            fill: '#FFFFFF',
            stroke: '#AAAAAA',
        };
        style.point.pendingHover = {
            fill: '#DFDFDF',
            stroke: '#BABABA'
        };
        style.point.done = {
            ...style.point.base,
            stroke: '#4BC9F6',
        };
        style.point.doneHover = {
            stroke: '#b7e9fb'
        };
        style.point.active = {
            ...style.point.base,
            stroke: '#56B64C',
        };
        style.point.activeHover = {
            stroke: '#bbe1b7'
        };
        style.point.terminated = {
            ...style.point.base,
            stroke: '#EF5839',
        };
        style.point.terminatedHover = {
            stroke: '#f8bcaf'
        };

        style.hConnector = {
            base: {
                strokeWidth: 4,
            }
        };
        style.hConnector.pending = {
            ...style.hConnector.base,
            stroke: '#AAAAAA'
        };
        style.hConnector.done = {
            ...style.hConnector.base,
            stroke: '#4BC9F6'
        };
        style.hConnector.active = {
            ...style.hConnector.base,
            stroke: '#56B64C'
        };
        style.hConnector.terminated = {
            ...style.hConnector.base,
            stroke: '#EF5839'
        };

        style.phase = {
            base: {
                fill: "#FFFFFF",

            }
        };

        let make = {};
        make.stage = (stage = null) => {
            if (stage) {
                make.__stage = stage;
                make.__layer = {
                    bg: new Konva.Layer(),
                    phase: new Konva.Layer(),
                    point: new Konva.Layer(),
                };
                for (let key of Object.keys(make.__layer)) {
                    make.__stage.add(make.__layer[key]);
                }
                let bgRect = new Konva.Rect({
                    x: 0,
                    y: 0,
                    width: stage.width(),
                    height: stage.height(),
                    fill: "#DDDDDD",
                    listening: true  // listen for clicks on the stage rectangle
                });
                make.__layer.bg.add(bgRect);
            }
            else {
                return make.__stage;
            }
        };
        make.layerPoint = (layer = null) => {
            return make.__layer.point;
        };
        make.layerPhase = (layer = null) => {
            return make.__layer.phase;
        };
        make.draw = () => {
            for (let key of Object.keys(make.__layer)) {
                make.__layer[key].draw();
            }
        }
        make.point = (pos, type) => {
            let useStyle = style.point[type];
            let useHoverStyle = style.point[type + "Hover"];
            let point = new Konva.Circle({
                x: pos.x,
                y: pos.y,
                ...useStyle
            });
            point.setAttr("ptype", type);
            point.on("mouseenter", (evt) => {
                stage.container().style.cursor = 'pointer';
                point.stroke(useHoverStyle.stroke);
                make.layerPoint().draw();
            });
            point.on("mouseout", (evt) => {
                stage.container().style.cursor = 'default';
                point.stroke(useStyle.stroke);
                make.layerPoint().draw();
            });
            make.layerPoint().add(point);
            return point;
        };
        make.connect = (from, to) => {
            let connectorType = to.getAttr("ptype");
            let linePoints = [];
            if (to.y() - from.y() == 0) {
                linePoints = [to.x(), to.y(), from.x(), from.y()];
            }
            else {
                linePoints = [
                    to.x(), to.y(),
                    to.x() - 50, to.y(),
                    to.x() - 50, from.y(),
                    from.x(), from.y()
                ];
            }
            let connector = new Konva.Line({
                points: linePoints,
                ...style.hConnector[connectorType]
            });
            make.layerPoint().add(connector);
            connector.zIndex(0);
            return connector;
        };
    </script>
    <script>
        let stageWidth = 1000;
        let stageHeight = 300;
        // first we need to create a stage
        let stage = new Konva.Stage({
            container: 'container',   // id of container <div>
            width: stageWidth,
            height: stageHeight
        });
        make.stage(stage);
        let a = make.point({ x: 50, y: 100 }, "done");
        let b = make.point({ x: 150, y: 100 }, "done");
        let c = make.point({ x: 250, y: 130 }, "pending");
        make.connect(a, b);
        make.connect(b, c);
        make.draw();
    </script>
</body>

</html>