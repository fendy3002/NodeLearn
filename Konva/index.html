<!DOCTYPE html>
<html>

<head>
</head>

<body>
    <div id="stage-parent" style="overflow-x:scroll">
        <div id="container"></div>
    </div>
    <script src="https://unpkg.com/konva@4.0.0/konva.min.js"></script>
    <script>
        let style = {};
        style.point = {
            base: {
                radius: 13,
                fill: '#FFFFFF',
                stroke: '#AAAAAA',
                strokeWidth: 6
            }
        };

        style.point.pending = {
            ...style.point.base,
            fill: '#FFFFFF',
            stroke: '#AAAAAA',
        };
        style.point.pendingHover = {
            fill: '#DFDFDF',
            stroke: '#BABABA'
        };
        style.point.done = {
            ...style.point.base,
            stroke: '#4BC9F6',
        };
        style.point.doneHover = {
            stroke: '#b7e9fb'
        };
        style.point.active = {
            ...style.point.base,
            stroke: '#56B64C',
        };
        style.point.activeHover = {
            stroke: '#bbe1b7'
        };
        style.point.terminated = {
            ...style.point.base,
            stroke: '#EF5839',
        };
        style.point.terminatedHover = {
            stroke: '#f8bcaf'
        };
        style.hConnector = {
            base: {
                strokeWidth: 4,
            }
        };
        style.hConnector.pending = {
            ...style.hConnector.base,
            stroke: '#AAAAAA'
        };
        style.hConnector.done = {
            ...style.hConnector.base,
            stroke: '#4BC9F6'
        };
        style.hConnector.active = {
            ...style.hConnector.base,
            stroke: '#56B64C'
        };
        style.hConnector.terminated = {
            ...style.hConnector.base,
            stroke: '#EF5839'
        };

        let make = {};
        make.layer = (layer = null) => {
            if (layer) {
                make.__layer = layer;
            }
            else {
                return make.__layer;
            }
        }
        make.point = (pos, type) => {
            let useStyle = style.point[type];
            let useHoverStyle = style.point[type + "Hover"];
            let point = new Konva.Circle({
                x: pos.x,
                y: pos.y,
                ...useStyle
            });
            point.setAttr("ptype", type);
            point.on("mouseover", (evt) => {
                point.stroke(useHoverStyle.stroke);
                layer.draw();
            });
            point.on("mouseout", (evt) => {
                point.stroke(useStyle.stroke);
                layer.draw();
            });
            make.layer().add(point);
            return point;
        };
        make.connect = (from, to) => {
            let connectorType = to.getAttr("ptype");
            let linePoints = [];
            if (to.y() - from.y() == 0) {
                linePoints = [to.x(), to.y(), from.x(), from.y()];
            }
            else {
                linePoints = [
                    to.x(), to.y(), 
                    to.x() - 50, to.y(), 
                    to.x() - 50, from.y(), 
                    from.x(), from.y()
                ];
            }
            let connector = new Konva.Line({
                points: linePoints,
                ...style.hConnector[connectorType]
            });
            make.layer().add(connector);
            connector.zIndex(1);
            return connector;
        };
    </script>
    <script>
        let stageWidth = 1000;
        let stageHeight = 300;
        // first we need to create a stage
        var stage = new Konva.Stage({
            container: 'container',   // id of container <div>
            width: stageWidth,
            height: stageHeight
        });
        // then create layer
        var layer = new Konva.Layer();
        make.layer(layer);
        var stageRect = new Konva.Rect({
            x: 0,
            y: 0,
            width: stageWidth,
            height: stageHeight,
            fill: "#DDDDDD",
            listening: true  // listen for clicks on the stage rectangle
        });
        layer.add(stageRect);
        stageRect.zIndex(0);
        let a = make.point({ x: 50, y: 100 }, "done");
        let b = make.point({ x: 150, y: 100 }, "done");
        let c = make.point({ x: 250, y: 130 }, "pending");
        make.connect(a, b);
        make.connect(b, c);
        // add the layer to the stage
        stage.add(layer);

        // draw the image
        layer.draw();
    </script>
</body>

</html>